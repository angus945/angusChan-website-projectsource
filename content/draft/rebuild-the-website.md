---
title: "【開發日誌】個人網站重建"
date: 2022-06-08
lastmod: 2022-06-08

draft: true

description: 個人網站的重建過程分享
tags: [website, hugo]

## image for preview
# feature: 

## image for open graph
# og: "/post/about-learning/featured.jpg"

## when calling "resources" shortcode, well link to static folder with this path 
resources: /devlog/rebuild-the-website/

## customize page background
# background: [watercolor-A] 

## listout with recommand, new and all pages
# listable: [recommand, all]
---

<!--more-->
 
## 網站重建 +

去年為了想要新的空間放置文章，所以初次接觸網頁，從頭學習 HTML, CSS, JS，並用 Hugo 網頁生成器製作出自己的網站。

但因為忙著處理備審，所以做好之後也沒時間維護，最後網站才發幾篇文章就被放置了。後來我嘗試寫更多內容時也注意網站的些缺陷，與其花時間修 不如就重建吧。

### 問題分析 +

不過，為了防止重蹈舊網站的覆轍，在開始前必須先釐清舊版網站的問題。

**分類模式**

我在舊版網站使用的分類格式為：

+ 日誌 Blog  
  由於我有寫學習日至的習慣，所以理所當然的建立了日誌資料。
+ 筆記 Notes  
  寫筆記是我常用的學習方法，巴哈小屋也分享了不少個人筆記，因此網站也建立了筆記資料夾。
+ 教學 Tutorials  
  當時會建立網站的原因之一就是為了正在寫的距離場教學，所以也添加了資料夾。

這個分法沒什麼問題…至少以剛建立時的需求來說如此。但後來我為了百川申請寫了一些特別的文章，是關於自學與遊戲教育相關的內容。那麼問題來了，以分類模式來說它應該會更偏向 blog ，但是性質又和學習日誌的內容不同。

再來，因為改變學習的方式，我的筆記也開始嘗試將細節解釋清楚，讓他變得更加「教學型」，那它應該被分類為 note 還是 Tutorials？

又或是分享學習資源的文章，他和教學有關，但實際的教學又不是我製作的，該放在 tutorials 還是 blog？

所以這次重建也是要尋找一個好的分類方法。

**資源混雜** 

除了分類以外，網頁的專案資料夾混亂也是一個原因…或甚至可以說是主要原因，

因為我是去年嘗試製作網站時才接觸網頁前端的，在此之前沒有任何經驗，製作時因為各種原因反覆修改模板，對自己需要的功能也還不清楚，於是最後留下一堆多餘或是有缺陷的系統，此網頁難以維護，文章編寫不易。

TODO 資料夾圖片

事隔一年，我對自己的需求也更清楚了，拋棄舊版的架構重新開始，讓網頁更好維護。

## 重新開始 +

因為我不是網頁專業，也不是主修設計的，更沒有學過任何後端知識，因此這次重建與初次製作往暫時一樣，會使用現成的資源進行開發。

更何況目的也不是學習前端本身，與其大費周章從頭規劃界面和排版，不如修改現成的模板，再把自己的專業結合進去，才能有效發揮自己的專長。

因此這次會一樣是透過 Hugo 建立網站，在 github page 上託管網站，然後把一些 「有趣」 的功能也加進網站專案框架中。

重複的部份這次就省略了，可以參考舊版網站的 [開發日誌]({{< ref "devlog/build-the-fistsite" >}})，這篇就只把重點放在新東西上。

### 模板選擇 +

舊版網頁的樣式雖然我也蠻喜歡的，但缺點就是背景一片死白，晚上看的時候眼睛很痛，所以這次改用了可以切換黑白主題的極簡模板 [fuji](https://themes.gohugo.io/themes/hugo-theme-fuji/)，可以透過畫面右下方的按鈕切換明暗模式，如此一來晚上看的時候就沒那麼刺眼了。

{{< resources/image "fuji-theme.jpg" "80%" "引用自主題的預覽圖" >}}

為了擴展功能我也翻了模板的原始碼，似乎是和一個叫 scss 的階層式樣式表有關。與 CSS 不同，這種樣式表允許透過變數指定色彩等數值。但具體的運作原理我也不清楚，我只有摸到足夠讓我擴展內容的程度而已，總之這是一個蠻理想的模板～

```scss
body {
  background-color: var(--color-bg);
  color: var(--color-font);

  @include link-1();
}
```

### 文章分類 +

Hugo 建立的的網站結構是與資料夾格式相同的，因此當文章資料夾沒有取好名稱就可能引發網站內容的分類危機。第一次做的時候就是因為連自己的需求都還不夠了解，草率分類才導致新文章都不知道該怎麼放。因此這次開始前首先要做的就是確認好真正的需求。

+ **日誌 Devlog**  
  專案開發與學習日誌，通常是用於紀錄與分享自己的學習過程，盡量讓內容以有趣為主，不會有太具體的實做與技術細節。

+ **學習 Learn**  
  通常是學習筆記與教學之類的文章，會有更多實做細節，一方面加深印象填補知識空缺，另一方面也是為了回饋網路社群，學習資源的整理也會分享在這。

+ **文章 Post**  
  其他個人文章，分享自己對各種事情的經歷與看法，例如自學歷程、學習感想之類的。

其實當初也不是真的草率分類，而是因為處於轉型階段，寫作的格式也尚未確定，才導致預想與實際不符。但有了這一年的寫作經驗後我也更清楚自己的需求了，上述的分類方式才比較符合我的文章類型。

### 資源嵌入 +

圖文並茂是文章吸引目光的要點之一，適當的插入圖片能夠幫助讀者帶入情境，在技術文章搭配直觀圖片也是輔助理解的重要手段。

雖然我在舊版網站中也製作了一個資源嵌入的函式，能夠讓我在文章中插入指定的資源。它會根據文章網址自動抓取對應路徑上的資源，雖然乍聽之下挺方便的，不需要手動指定整個路徑。但實際用過後才發現，由於 Hugo 的網頁結構與資料夾相同，因此每篇文章都得建立獨立的資源資料夾來放嵌入資源，如果在系列文章裡會很麻煩。

因此新網站我改成需要在文章設置中手動設置一次路徑，後續調用嵌入函式時就會根據相對路徑進行尋找，如此一來就能避免大量的資源資料夾了。

+ **圖片嵌入**  
  {{< resources/image "resources-image.jpg" "80%" "可以設定圖片的註解" >}}

+ **音效嵌入**  
  {{< resources/audio "resources-audio.mp3" >}}

+ **資源嵌入**  
  {{< resources/assets "" "可以連接到網頁的儲存庫，分享專案原始碼之類的" >}}

### 內容上色 +

除了嵌入圖片外，我也其慣透過文字上色來強調某些內容。雖然 markdown 格式能夠直接接收 `html` 與 `css` ，<span style="color:red">但要插入完整標籤與樣式表還是太麻煩了</span>。

```html
<span style="color:red">但要插入完整標籤與樣式表還是太麻煩了</span>
```

我也有嘗試透過 hugo 函式進行上色，但那樣反而比 html 還難讀，所以也放棄了。這次重作的時候我也花時間研究了一下 markdown 文字上色的方法，發現其實 html 是可以自訂 tag 的，所以我就訂了單字 <h>  h  </h> 當做強調重點、單字 <c>  c  </c> 當作註解。


```html
所以我就訂了單字 <h>  h  </h> 當做強調重點、單字 <c>  c  </c> 當作註解
```

雖然我還是不喜歡文章原始檔裡有 html 原始標籤，但至少比完整的 css 設置或 hugo 函式好多了。

### 著色器嵌入 +

除了常規的內容嵌入與上色外，這次重建我也幫網站增加了一個重要的新功能：著色器嵌入。

初學習著色器時，我看到了一個很有趣的互動式教學網站 [The Book of Shaders](https://thebookofshaders.com/)，網站中所有的著色器都是實時渲染的，可以根據讀者的動作即時反應。而網站官方也有公開它們使用的嵌入[函式庫](https://github.com/patriciogonzalezvivo/glslCanvas
)供人使用，只需要用 js 引用後就可以方便的嵌入互動元素。

於是我就透過這個函式庫，在整合進自己的資源嵌入函式後，就能夠隨意添加有趣的內容了。

{{< resources/shader "300 300" "resources-shader.frag" >}}{{</ resources/shader >}}

比較麻煩的是用來放著色器腳本的資料夾沒辦法即時更新，預覽起來有點麻煩，但還好 vscode 有一個不錯的插件 [glsl-canvas](https://marketplace.visualstudio.com/items?itemName=circledev.glsl-canvas) ，可以在編輯器裡預覽 glsl shader 運行起來的樣子，用於初步除錯。

### 互動式內容 +

雖然實時渲染的內容很有趣，但如果無法與讀者互動的話其實和放圖沒兩樣。於是我也想半法添加了互動內容，能夠讓讀者對渲染內容進行一定程度的操控。

webgl 渲染的時候可以透過 js 變數傳遞給著色器的 uniform 變數，利用這點我也擴展了自己的嵌入函式的功能，添加了幾種類型的變數輸入：

**一維浮點 - float silder**

{{< resources/shader "300 300" "resources-shader.frag" >}}
float u_colorR 0 1 0.5,
float u_colorG 0 1 0.5,
float u_colorB 0 1 0.5
{{</ resources/shader >}}

**一維整數 - int silder**

{{< resources/shader "300 300" "resources-shader.frag" >}}
int u_shape 0 2 0
{{</ resources/shader >}}

**二維浮點 - vector picker**
{{< resources/shader "300 300" "resources-shader.frag" >}}
vector u_position -1 -1 1 1 0 0
{{</ resources/shader >}}

{{< resources/assets "resources-shader.frag" "> 想看這個著色器的原始碼可以點我 <" >}}

透過 Hugo 的 json 打包功能 [jsonify](https://gohugo.io/functions/jsonify/) 在網站建置時會將變數資料透過 json 的格式傳入 html data 的欄位中，並生成輸入用的 html 元素。

當讀者載入網站的時候，負責初始化著色器的 js 腳本便會搜索一遍所有著色器內容，將 html 事件與 shader 的變數輸入連接上，達成動態修改參數的功能。如果讀者在修改參數時能夠即時展現結果，能更有效的加深印象。

除了著色器嵌入外，函式庫的提供者還有另一個系統能夠直接嵌入整個著色器編輯器 [GlslEditor](https://github.com/patriciogonzalezvivo/glslEditor) 能夠讓讀者直接在網頁上修改程式碼。

{{< resources/image "glsl-editor.gif" "80%" "圖片引用自 GlslEditor" >}}

但是嵌入整個編輯器還是太肥了，會讓網頁載入更耗時，而且還要合併進自己的嵌入框架也沒那麼容易，所以就放棄那麼複雜的內容了，我對目前的效果很滿意了。 

### 程式框修正 +

因為我的學習領域會碰到不少程式碼，文章也會需要嵌入範例程式，雖然程式匡的格式模板已經有提供了，不過原本的樣式是沒有標題的。

```
default code block
```

但我的文章內容可能混雜不只一種語言，怕讀者看到可能混亂。為了修正這點，我原本嘗試研究 hugo 的 markdown to html 編譯，或是找 css 格式有沒有方法直接幫程式匡添加標題，但太複雜放棄了。

於是最後我直接修改 hugo 生成網頁時的模板，利用 hugo 提供的 Regex 搜索函式直接抓出所有 html 程式匡，硬插了 `<span>` 和 `<hr>` 上去。搭拉，程式匡標題完成～

```hugo
{{ $codeblocks := findRE "<code class=\"language-(.*)\">(.|\n)*?</code>" $content }}
```

Regex 真的是神器，現在我只要編寫文章時有在 markdown 的 code block 上添加語言類別就能自動顯示標題了。

{{< resources/image "code-block.jpg" >}}

```cs
void function()
{
    // csharp code block
}
```

```hlsl
fragment()
{
    // shader code block
}
```

如此一來讀者在閱讀時也能輕鬆許多，不用額外備註或是靠內容差異去猜語言了。

### 推薦清單 +

網站的主頁面我決定列出一些推薦的文章，讓初次進入網站的讀者能夠快速了解網站內容。

至於推薦清單的內容，我透過文章各自的屬性進行設置，調整這篇文章能夠被哪些列表展示。

```toml
# listable: [recommand, all]
```

而網站建置時就會根據這些屬性，過濾出要推薦的清單，再利用資料打包函式把列表打包成 json 陣列，傳入 JavaScript。

TODO 圖片

最後只要在頁面載入時隨機抽出然後顯示就能達成隨機推薦的目標。

### 滾動條修正 +

因為覺得網頁右側的滾動條很丑，所以我在舊版網站裡直接透過 css 將它隱藏了。但是後來收到回饋說沒有滾動條在閱讀長篇文章的時候難以辨識當前進度，並且也沒辦法快速捲動，因此這次我決定保留滾動條，但想辦法修成好看的樣式。

在 chrome 中我使用的是 overlay 的格式，讓滾動條覆蓋在頁面上就不需要醜醜的欄位了。但因為 firefox 不兼容這種樣式，因此我只能把把欄位改細，顏色改淺一點讓它看起來沒那麼丑而已。

{{< resources/image "website-scrollbar.jpg" >}}

### 動態背景 +

雖然能夠調整網頁的黑白樣式，但是單色背景看起來還是太乾了。就算讓背景放圖片也不夠有趣，因此我也把著色器的腦筋動到背景上了，我想透過著色器渲染整個網頁的背景。

雖然文章嵌入的函式庫很方便，也能直接用在背景渲染上，但因為他的方便也導致使用者對他的掌控度沒那麼高，如果想要對一些細節做調整反而困難。

因次背景的著色器我決定用另一個函式庫 three.js，雖然設置起來更加複雜，但也能讓我微調更多細節，材質屬性、模型（如果有）以及渲染幀數等等，

背景是使用一個覆蓋全畫面的 canvas 進行繪製的，其實處理起來沒有複雜到哪裡，重點還是取決與著色器本身。

TODO 圖片

同樣利用 json 打包成陣列方便讀，傳遞給 js 隨機改變背景，除此之外也會在載入網頁的時候隨機生成種子碼傳入著色器，如此一來就能讓著色器產生變化。

最後我找了水彩的桌布貼圖，然後加上色彩混合的著色器，漂亮的背景就完工了，極簡風格只需要稍微修飾就會變得很有質感了 ~~

TODO 圖片

需要花一些時間調整參數就是了，好在 hugo 的 data 資料夾可以存放 json 檔案，這樣我就可以預先設置好參數，使用圖片等資料，文章只需要指定要用的背景就好。

TODO 圖片

## 感謝閱讀

### 成果對比

主題的預覽網頁，也是模板最初的樣子

https://github.dsrkafuu.net/hugo-theme-fuji/

### 待做清單


留言板

firebase ?

尚未製作

<!-- https://mail.google.com/mail/u/0/#search/comment/FMfcgzGkZkRcSJXXdJrMVjSMpZxSjxGg -->



