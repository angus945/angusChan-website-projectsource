---
title: "【開發日誌】個人網站重建"
date: 2022-06-08
lastmod: 2022-06-08

draft: true

description: 個人網站的重建過程分享
tags: [website, hugo]

## image for preview
# feature: 

## image for open graph
# og: "/post/about-learning/featured.jpg"

## when calling "resources" shortcode, well link to static folder with this path 
resources: /devlog/rebuild-the-website/

## customize page background
# background: [watercolor-A] 

## listout with recommand, new and all pages
# listable: [recommand, all]
---

<!--more-->
 
## 網站重建 +

離初次接觸網頁知識，從頭學習 HTML, CSS, JS 並用 Hugo 網頁生成器製作出了個人網站已經過去一年然當時對這項成果還算滿意，但隨著我寫作的過程也逐漸意識各種缺陷，函示調用不易、專案架構混雜等等，雖然有嘗試進行重構，但還是覺得重建一次會更簡單。

### 問題分析 +

為了防止重蹈覆轍，在重建開始前必須先釐清舊版網站的問題。

**_分類模式_**

我在舊版網站使用的分類模式為：

+ 日誌 Blog  
  因為我有將學習過程透過日誌進行記錄的習慣，所以網站當然需要對應的分類。
+ 筆記 Notes  
  寫筆記也是我常用的學習方法，為了與性質較輕鬆的日誌區隔，因此也建立了筆記分類。
+ 教學 Tutorials  
  教學是我建立網站的主要原因之一，就是為了將新學習方法所產生產物進行保存，所以教學分類也是必要的。

TODO 資料夾圖片

這個分法沒什麼問題…至少以剛開始的需求來說還沒問題，但後來我為了申請百川，挑戰寫了一些性質更為特殊的文章，分類危機也因此浮現。那是內容關於「學習」但並不是學習日誌，以及與「遊戲」相關卻又不屬於遊戲開發的文章，不可能被歸類在教學與筆記當中，但將他視為日誌也不太恰當。

再來，因為改變學習的方式，我的筆記也開始嘗試將細節解釋清楚，讓他變得更加像一種「教學」，那它應該被分類為 note 還是 Tutorials？又或是分享學習資源的文章，他和學習有關但實際的教學內容又不是我製作的，該放在 tutorials 還是 blog？因此這次重建也是為了尋找新的模式來對文章進行分類。

**資源混雜** 

除了分類以外，專案內容混亂也是一個原因…甚至可以說是主要原因，畢竟改變分類只需要移動資料夾就好了，沒必要大費周章重做整個網站。當時網頁知識並不熟悉，也沒有任何經營與管理網站的經驗，更重要的是我對自己的需求也還不了解，才在製作時走一步算一步，反覆修改模板最終留下一堆有缺陷的系統，讓網站專案難以維護。

TODO 資料夾圖片

## 重新開始 +

這次重建與上次一樣會使用現成的資源開發，畢竟我不是專攻網頁設計，重建的目的也不是為了學習，與其大費周章從頭刻出介面與排版，不如尋找對胃口的模板修改再把自己的專業結合進去，才能有效展現自己的專長。

因此我這次也打算使用 Hugo 建立網站，然後把一些 「有趣」 的功能也加進網站專案框架中。重複的部份可以參考舊版網站的[開發日誌]({{< ref "devlog/build-the-fistsite" >}})，這篇就只把重點放在新的東西上。

### 模板選擇 +

雖然我也蠻喜歡舊版網頁的樣式，但它背景一片死白讓晚上觀看文章時太刺眼，所以這次改用了可以切換黑白主題的極簡模板 [fuji](https://themes.gohugo.io/themes/hugo-theme-fuji/)。它可以透過畫面右下方的按鈕切換明暗模式，這樣就不用擔心在暗處閱讀會很吃力了。

{{< resources/image "fuji-theme.jpg" "80%" "引用自主題的預覽圖" >}}

為了對樣式切換的功能進行擴展我也翻了模板的原始碼，似乎與叫 scss 的階層式樣式表有關，與 CSS 不同，這種樣式表允許透過變數指定色彩等數值。但具體的運作原理我也不清楚，我只有摸到足夠讓我擴展內容的程度而已，總之這是一個蠻理想的模板～

```scss
body {
  background-color: var(--color-bg);
  color: var(--color-font);

  @include link-1();
}
```

### 文章分類 +

Hugo 建立的的網站結構是與資料夾格式相同的，因此當資料夾沒有取好名稱就可能引發網站內容的分類危機。第一次做的時候就是因為連自己的需求都還不夠了解，草率分類才導致新文章都不知道該怎麼放，因此重建的首要目標就是確認好自己的真正需求。

+ **日誌 Devlog**  
  專案開發與學習日誌，通常是用於紀錄與分享自己的學習過程，盡量以有趣為主所以不會有太具體的實做與技術細節。

+ **學習 Learn**  
  通常是學習筆記與教學之類的文章，會有更多實做細節，一方面加深印象填補知識空缺，另一方面也是為了回饋網路社群，學習資源的整理也會分享在這。

+ **文章 Post**  
  其他個人文章，分享自己對各種事情的經歷與看法，例如自學歷程、學習感想之類的。

### 資源嵌入 +

圖文並茂是文章吸引目光的要點之一，適當的插入圖片能夠幫助讀者帶入情境，在技術文章搭配直觀圖片也是輔助理解的重要手段。

雖然在舊網站中也有製作資源嵌入用的函式，能讓我在文章嵌入各種資源，它會根據文章網址自動抓取對應路徑上的資源，不需要手動指定整個路徑。將所有工作都交給程式雖然輕鬆，但也意味者我失去了這些事的主導權：我必須配合程式建立資料夾。

為了在輕鬆與主導權之間取得平衡，這次我將新的系統設計成需要在文章設置中手動設置一次路徑，後續調用嵌入函式時就會根據相對路徑進行尋找，如此一來就能自由指定資源的路徑，同時省略重複的指定工作。

```toml
resources: /devlog/rebuild-the-website/
```

+ **圖片嵌入**  
  {{< resources/image "resources-image.jpg" "80%" "可以設定圖片的註解" >}}

+ **音效嵌入**  
  {{< resources/audio "resources-audio.mp3" >}}

+ **資源嵌入**  
  {{< resources/assets "" "可以連接到網頁的儲存庫，用於分享程式原始碼之類的" >}}

### 內容上色 +

除了嵌入圖片外，我也其慣透過文字上色來強調某些內容。雖然 markdown 格式能夠直接接收 `html` 與 `css` 格式，<span style="color:red">但要插入完整標籤與樣式表還是太麻煩了</span>，還會導致文章原始檔難以閱讀。

```html
<span style="color:red">但要插入完整標籤與樣式表還是太麻煩了</span>
```

我也有嘗試透過 hugo 函式進行上色，但那樣反而比 html 還難讀所以也放棄了。這次重作的時候我也花時間研究了一下 markdown 文字上色的方法，發現其實 html 是可以自訂 tag 的，所以我就訂了單字 <h>  h  </h> 當做強調重點、單字 <c>  c  </c> 當作註解，以及單字  <r> r </r> 作為警告顏色。


```markdown
所以我就訂了單字 <h>  h  </h> 當做強調重點、單字 <c>  c  </c> 當作註解，以及單字  <r> r </r> 作為警告顏色。
```

雖然我還是不喜歡文章原始檔裡有醜醜的標籤，但至少現在變簡潔多了。

### 著色器嵌入 +

除了常規的內容嵌入與上色外，這次重建我也增加了一個重要的新功能：著色器嵌入。

初學習著色器時我曾看到過一個很有趣的互動式教學網站 [The Book of Shaders](https://thebookofshaders.com/)，網站中所有的著色器都是實時渲染的，可以根據讀者的動作即時反應。而網站官方也有公開它們使用的嵌入[函式庫](https://github.com/patriciogonzalezvivo/glslCanvas
)供人使用，只需要用 js 引用後就可以方便的嵌入互動元素。

於是我也將個這個函式庫整合進自己的資源嵌入函式，如此便能隨意添加有趣的內容了。

{{< resources/shader "300 300" "resources-shader.frag" >}}{{</ resources/shader >}}

比較麻煩的是用來放著色器腳本的資料夾沒辦法即時更新，預覽起來有點麻煩，但還好 vscode 有一個不錯的插件 [glsl-canvas](https://marketplace.visualstudio.com/items?itemName=circledev.glsl-canvas) ，可以在編輯器裡預覽 glsl shader 運行起來的樣子，用於初步除錯。

TODO glslcanvas image

### 互動式內容 +

雖然實時渲染的概念很有趣，但對讀著來說其實就和 GIF 圖片沒兩樣...如果無法進行互動的話。於是我添加了互動內容，透過 javaScript 傳遞參數給著色器，如果讀者在修改參數時能夠即時展現其影響，就能更有效的加深印象。

**一維浮點 - float silder**

{{< resources/shader "300 300" "resources-shader.frag" >}}
float u_colorR 0 1 0.5,
float u_colorG 0 1 0.5,
float u_colorB 0 1 0.5
{{</ resources/shader >}}

**一維整數 - int silder**

{{< resources/shader "300 300" "resources-shader.frag" >}}
int u_shape 0 2 0
{{</ resources/shader >}}

**二維浮點 - vector picker**
{{< resources/shader "300 300" "resources-shader.frag" >}}
vector u_position -1 -1 1 1 0 0
{{</ resources/shader >}}

{{< resources/assets "resources-shader.frag" "> 想看這個著色器的原始碼可以點我 <" >}}

網站建置時會透過 Hugo 的資料打包功能 [jsonify](https://gohugo.io/functions/jsonify/) 將變數資料以 json 的格式傳入 html 標籤的 data 欄位中，並生成輸入用的互動元素。當讀者載入網站的時候，負責初始化著色器的腳本便會搜索一遍所有著色器內容，將 html 事件與 shader 的變數輸入連接上，達成動態修改參數的功能。

除了實時渲染之外，函式庫的提供者還有另一個系統能夠直接嵌入整個著色器編輯器，能夠讓讀者直接在網頁上修改程式碼：[GlslEditor](https://github.com/patriciogonzalezvivo/glslEditor) 

{{< resources/image "glsl-editor.gif" "80%" "圖片引用自 GlslEditor" >}}

但是嵌入整個編輯器會讓網頁載入更耗時，要合併進自己的網頁框架也沒那麼容易，所以我就放棄這個部分了。我對目前的成果很滿意～

### 程式框修正 +

因為我的主要學習領域就是程式（遊戲開發），所以文章也會需要嵌入程式需求。雖然模板就有提供預設的程式框，但原本的樣式沒有標題。我的文章內容可能混雜不只一種程式語言，如果沒有標題會難以分辨內容。

```
default code block
```

為了修正這點，我原本嘗試研究 hugo 的 markdown to html 編譯，或是找 css 格式有沒有方法直接幫程式匡添加標題，但沒有成功。最後我直接修改 hugo 生成網頁時的模板，利用 hugo 提供的 Regex 搜索函式直接抓出所有 html 程式匡，硬插了 `<span>` 和 `<hr>` 上去。

搭拉，程式匡標題完成～

```hugo
{{ $codeblocks := findRE "<code class=\"language-(.*)\">(.|\n)*?</code>" $content }}
```

Regex 真的是神器，現在我只要編寫文章時有在 markdown 的 code block 上添加語言類別就能自動顯示標題了。

```cs
void function()
{
    // csharp code block
}
```

```hlsl
fragment()
{
    // shader code block
}
```

{{< resources/image "code-block.jpg" >}}

如此一來讀者在閱讀時也能輕鬆許多，不用額外備註或是靠內容差異去猜語言了。

### 推薦清單 +

舊版網站中我也是在主頁面放上推薦清單，但之前是透過文章的屬性設置「重要度」去排序清單，這樣做雖然有效，但也只能顯示固定而且有限的內容。這次重建我希望能夠讓列表推薦更多內容，除了「推薦」本身的用途之外，也能讓初次進入網的訪客快速了解網站性質。

因此我嘗試製作了隨機推薦的功能，透過文章各自的屬性進行設置，調整這篇文章能夠被哪些列表展示。

```toml
# listable: [recommand, all]
```

而網站建置時就會根據這些屬性，過濾出要推薦的清單，再利用資料打包函式把列表打包成 json 陣列傳入 JavaScript。

TODO 圖片 打包 json

有了 Json 真的方便許多，最後只要在頁面載入時隨機抽出推薦清單的幾項元素，將內容填入 Html 就能達成隨機推薦的功能。

TODO 隨機推薦

### 滾動條修正 +

因為覺得網頁右側的滾動條很難看，我在舊版網站裡直接透過 css 將它隱藏了。但是後來收到回饋說沒有滾動條在閱讀長篇文章的時候難以辨識當前進度，並且也沒辦法快速捲動，所以這次我決定保留滾動條，但想辦法修成好看的樣式。

在 chrome 中我使用的是 overlay 的格式，讓滾動條覆蓋在頁面上就不需要醜醜的欄位了。但 firefox 不兼容這種樣式，所以我只能把把欄位改細，顏色改淺一點讓它好看點。

{{< resources/image "website-scrollbar.jpg" >}}

### 動態背景 +

雖然能夠調整網頁的黑白樣式，但是單色背景還是感覺太乾了，雖然讓背景放圖片會好一點，但我覺得不夠有趣，既然我能在文章中嵌入著色器，何不也做個能實時炫染的背景呢？

雖然文章嵌入的著色器函式庫很方便，也能直接用在背景渲染上，但因為他的方便也導致使用者對他的掌控度沒那麼高，如果想要對一些細節做調整反而困難。因此背景的著色器我決定用另一個函式庫 three.js，雖然設置起來更加複雜，但也能讓我微調更多細節，材質屬性、模型（如果有）以及渲染幀數等等。

背景是使用一個覆蓋全畫面的 canvas 進行繪製的，其實處理起來沒有複雜到哪裡，重點還是取決與著色器本身。

TODO 軌跡 圖片

每當進入網頁的時候，背景著色器也會隨之載入，並隨機生成種子碼傳入，如此一來就能讓背景產生變化。我先找了水彩的桌布貼圖，然後加上色彩混合的著色器，漂亮的背景就完工了。

TODO 圖片 水彩

需要花一些時間調整參數就是了，好在 hugo 的 data 資料夾可以存放 json 檔案，這樣我就可以預先設置好參數，使用圖片等資料，文章只需要指定要用的背景就好。

TODO 圖片 data template 和指定

## 感謝閱讀 +

感謝閱讀到這裡的你，如果喜歡文章內容還請按幾下 Like button :D

TODO like button

### 成果對比 +

最後再和剛開始的樣子做個對比。

TODO 對比
https://github.dsrkafuu.net/hugo-theme-fuji/

和初次製作不同，這次的網站有更多功能，更乾淨的專案架構，以及漂亮的動態背景，不得不說極簡風格只需要稍微修飾就會變得很有質感了 ~~

有個好看的網站不只能吸引更多人瀏覽內容，更重要的是這也能提升我充實內容的動力，寫日誌對我來說也是一件重要的事，能在漂亮的網站上分享自己的歷程可是一件令人開心的事。

### 待做清單 +

新版網站還沒有留言功能，之前我嘗試過幾個外嵌的留言版功能，但不是廣告被塞爆就是不支援訪客留言，所以這次還是先把留言功能擱著。

之後應該會找時間學習後端，搭配 firebase 製作一個自己的留言板吧，敬請期待 ~

<!-- https://mail.google.com/mail/u/0/#search/comment/FMfcgzGkZkRcSJXXdJrMVjSMpZxSjxGg -->

